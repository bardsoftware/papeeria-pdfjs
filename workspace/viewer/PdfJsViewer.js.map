{"version":3,"file":"PdfJsViewer.js","sourceRoot":"","sources":["PdfJsViewer.ts"],"names":[],"mappings":"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","sourcesContent":["/// <amd-dependency path=\"pdf.combined\" name=\"PdfJsModule\"/>\n/// <amd-dependency path=\"pdfjs-web/pdf_page_view\" name=\"PDFPageView\"/>\n/// <amd-dependency path=\"pdfjs-web/text_layer_builder\" name=\"TextLayerBuilder\"/>\n/// <amd-dependency path=\"pdfjs-web/ui_utils\" name=\"PdfJsUtils\"/>\n\nlet PdfJsModule: any;\nlet pdfjs: PDF.PDFJSStatic = PdfJsModule;\nlet PDFPageView, TextLayerBuilder, PdfJsUtils: any;\n\n// Interfaces for communication with other components\n// Logger logs message without attracting user attention\ninterface Logger {\n  error(msg: string);\n}\n\n// Alert shows message to the user\ninterface Alert {\n  show(msg: string)\n}\n\n// Utility to stop events\ninterface Utils {\n  stopEvent(e: Event | undefined);\n}\n\n// Internationalization utility\ninterface I18N {\n  text(key: string, ...args): string;\n}\n\nfunction fallbackRequestAnimationFrame(callback: any, element: any) {\n  window.setTimeout(callback, 1000/60);\n}\n\nif (!window.requestAnimationFrame) {\n  window.requestAnimationFrame = window.webkitRequestAnimationFrame ||\n      window.mozRequestAnimationFrame ||\n      window.oRequestAnimationFrame ||\n      window.msRequestAnimationFrame ||\n      fallbackRequestAnimationFrame;\n  pdfjs.disableStream = true;\n}\n\nenum ZoomingMode {\n  PRESET,\n  FIT_WIDTH,\n  FIT_PAGE\n}\n\n// This class is responsible for storing current value of zoom factor and recalculating it\n// in response to user actions.\nclass Zoom {\n  // Preset zoom scales from 25% to 400%\n  static readonly ZOOM_FACTORS = [0.25, 0.33, 0.5, 0.66, 0.75, 0.9, 1.0, 1.25, 1.5, 2.0, 4.0];\n  // scaling mode, one of the constants listed above\n  private mode?: ZoomingMode = undefined;\n  // Index of one of the preset scales. Used when mode is PRESET\n  private idxPresetScale = 0;\n  // Dynamically calculated scale which is used when mode is FIT*\n  private fittingScale?: number = undefined;\n  // Returns currently used scale in percents for display purposes\n  current(): number {\n    return Math.round(100 * (\n        this.mode == ZoomingMode.PRESET ? Zoom.ZOOM_FACTORS[this.idxPresetScale] : this.fittingScale || 1));\n  }\n\n  // Returns currently set zoom factor if preset mode is used or recalculates\n  // zoom factor depending on the fitting mode and page/container size.\n  factor(page: any, container: JQuery): number {\n    let value: number;\n    if (this.mode === ZoomingMode.PRESET) {\n      value = Zoom.ZOOM_FACTORS[this.idxPresetScale];\n    } else {\n      if (!this.fittingScale) {\n        // recalculating fitting scale\n        let viewport = page.getViewport(1);\n        if (this.mode === ZoomingMode.FIT_WIDTH) {\n          // leave some space for the scrollbar\n          this.fittingScale = (container.width() - 30) / viewport.width;\n        } else {\n          // leave some padding\n          const scaleHeight = (container.height() - 30) / viewport.height;\n          const scaleWidth = (container.width() - 30) / viewport.width;\n          this.fittingScale = Math.min(scaleHeight, scaleWidth);\n        }\n      }\n      value = this.fittingScale;\n    }\n    return value / PdfJsUtils.CSS_UNITS;\n  }\n\n  // Zooms in. If we already use preset then we only need to increase index. If we use fitting scale\n  // then we search for the closest greater preset scale.\n  zoomIn(): boolean {\n    if (this.mode !== ZoomingMode.PRESET) {\n      // searching for the first scale which is greater than abs(current scale)\n      let newPresetScale = 0;\n      if (this.fittingScale) {\n        for (let i = 0; i < Zoom.ZOOM_FACTORS.length; i++) {\n          if (Zoom.ZOOM_FACTORS[i] > this.fittingScale) {\n            newPresetScale = i;\n            break;\n          }\n        }\n      }\n      this.idxPresetScale = newPresetScale;\n      this.mode = ZoomingMode.PRESET;\n      return true;\n    }\n    if (this.idxPresetScale < Zoom.ZOOM_FACTORS.length - 1) {\n      this.idxPresetScale++;\n      return true;\n    }\n    return false;\n  }\n  // Zooms out. If we already use preset then we only need to decrease index. If we use fitting scale\n  // then we search for the closest lesser preset scale.\n  zoomOut(): boolean {\n    if (this.mode !== ZoomingMode.PRESET) {\n      // searching for the first scale which is greater than abs(current scale).\n      // Previous scale is the one which we need.\n      let newPresetScale = -1;\n      if (this.fittingScale) {\n        for (let i = 0; i < Zoom.ZOOM_FACTORS.length; i++) {\n          if (Zoom.ZOOM_FACTORS[i] > this.fittingScale) {\n            newPresetScale = i;\n            break;\n          }\n        }\n      }\n      this.idxPresetScale = newPresetScale === -1 ? Zoom.ZOOM_FACTORS.length - 1 : newPresetScale - 1;\n      this.mode = ZoomingMode.PRESET;\n      return true;\n    }\n    if (this.idxPresetScale > 0) {\n      this.idxPresetScale--;\n      return true;\n    }\n    return false;\n  }\n\n  // When we resize the container div we need to recalculate fitting scale.\n  onResize = () => {\n    if (this.mode !== ZoomingMode.PRESET) {\n      this.fittingScale = undefined;\n    }\n  };\n\n  setFitting(mode: ZoomingMode.FIT_PAGE | ZoomingMode.FIT_WIDTH) {\n    this.mode = mode;\n    this.fittingScale = undefined;\n  }\n\n  setPreset(presetScale: number) {\n    const idx = Zoom.ZOOM_FACTORS.indexOf(presetScale);\n    if (idx !== -1) {\n      this.idxPresetScale = idx;\n      this.mode = ZoomingMode.PRESET;\n    }\n  }\n}\n\ninterface PageTask {\n  // URL of the PDF document\n  url: string;\n  // Page which should be displayed\n  page: number;\n  // Calculated flag which indicates whether we're showing the contents of absolutely new file\n  // TODO: we probably need to remove it\n  isNewFile: boolean;\n  // Flag indicating if container size has changed\n  isResize: boolean;\n  // Identifier of the shown PDF file\n  mainFileId: string | undefined;\n  // Function which is called on task completion\n  complete: () => void;\n}\n\n// This is a queue of file open requests. Normally it consists of just a single task which is immediately executed,\n// however, sometimes two or three tasks may be enqueued. Tasks come from: compile events from the channel;\n// resize events from the layout and scrolling events from the viewer itself.\nclass Queue {\n  // We keep a reference to the last completed task to be able to skip tasks which need no re-rendering\n  lastCompleted: PageTask | undefined;\n\n  // task queue\n  private tasks: PageTask[] = [];\n\n  // Pushes a new task which requests showing the given page of file from the given url. If the last task has the\n  // same url, page and isResize flag then new task is ignored. In case when queue is empty, the last task is the\n  // last completed one.\n  // Task is removed from the queue when it completes. Calling complete() is a must, no matter if task was\n  // successful or not\n  push(url: string, page: number, isResize: boolean, mainFileId?: string) {\n    let isNewFile = true;\n    const lastTask = this.isEmpty() ? this.lastCompleted : this.tasks[this.tasks.length - 1];\n    if (lastTask) {\n      // Ignore task if it is exactly the same as the last one\n      if (lastTask.url == url && lastTask.page == page && lastTask.isResize == isResize) {\n        return;\n      }\n      // If urls are different then we're showing a new file and need more cleanup\n      isNewFile = (lastTask.mainFileId != mainFileId);\n    }\n    const task: PageTask = {\n      url: url,\n      page: page,\n      isNewFile: isNewFile,\n      isResize: isResize,\n      mainFileId: mainFileId,\n      complete: () => {\n        this.tasks.shift();\n        // This will make the last completed task not resize; thus new resize task will be scheduled even if the\n        // last completed was resize as well\n        task.isResize = false;\n        this.lastCompleted = task;\n      }\n    };\n    this.tasks.push(task);\n  }\n\n  pull(): PageTask {\n    if (this.isEmpty()) {\n      throw new Error(\"Task queue is expected to be non-empty in pull()\");\n    }\n    return this.tasks[0];\n  }\n\n  isEmpty(): boolean {\n    return this.tasks.length === 0;\n  }\n\n  clear() {\n    this.lastCompleted = undefined;\n    this.tasks = [];\n  }\n}\n\nconst THRESHOLD_INITIAL = 0.25;\nconst THRESHOLD_FACTOR = 2;\nconst CALMDOWN_TIMEOUT_MS = 150;\n\n// Borrowed from http://stackoverflow.com/questions/5527601/normalizing-mousewheel-speed-across-browsers\nfunction normalize_mousewheel(e: JQueryMouseEventObject): number {\n  let o = e.originalEvent as MouseWheelEvent;\n  let w = o.wheelDelta;\n  let n = 225;\n  let n1 = n-1;\n\n  let detail = o.detail;\n  // Normalize delta\n  let delta = (!detail) ? w / 120 : (w && w / detail != 0) ? detail / (w / detail) : -detail / 1.35;\n  if (Math.abs(delta) > 1) {\n    // Quadratic scale if |d| > 1\n    delta = (delta > 0 ? 1 : -1) * (Math.pow(delta, 2) + n1) / n;\n  }\n  // Delta *should* not be greater than 2...\n  return -Math.min(Math.max(delta / 2, -1), 1);\n}\n\ntype Callback = (...args) => void;\nclass CallbacksList {\n  private readonly callbacks: Callback[] = [];\n  add(cb: Callback) {\n    this.callbacks.push(cb);\n  }\n  invoke(...args) {\n    const context = this;\n    for (let cb of this.callbacks) {\n      cb.apply(context, args);\n    }\n  }\n}\n\nexport class PdfJsViewer {\n\n  static getPresetScales(): number[] { return Zoom.ZOOM_FACTORS; }\n\n  // These are from pdfjs library\n  pdfPageView: any;\n  currentFile?: PDF.PDFDocumentProxy;\n  currentFileUrl?: string;\n  currentPage: number = 0;\n  currentTask: PageTask | undefined;\n\n  // Some magic to handle weird touchpad events which send delta exceeding the threshold a few times in a row.\n  // Dynamic threshold basically cuts some scrolling events depending on the scroll delta value.\n  // Effective threshold will grow and shrink by THRESHOLD_FACTOR as it is hit,\n  // so that once we get delta=0.25 and decide to scroll, the next threshold will be twice bigger.\n  private effectiveThreshold: number = THRESHOLD_INITIAL;\n\n  private readonly zoom = new Zoom();\n  private readonly queue = new Queue();\n  private readonly pageReady = new CallbacksList();\n  private readonly textLayerFactory = {\n    createTextLayerBuilder: function(div: any, page: any, viewport: any) {\n      return new TextLayerBuilder.TextLayerBuilder({\n        textLayerDiv: div,\n        pageIndex: page,\n        viewport: viewport\n      })\n    }\n  };\n  // Flag indicating if we're in the process of page rendering.\n  // We ignore some events when flag is on.\n  private isRendering = false;\n\n  constructor(private readonly jqRoot: JQuery,\n              private readonly alert: Alert,\n              private readonly logger: Logger,\n              private readonly utils: Utils,\n              private readonly i18n: I18N) {\n    this.zoom.setFitting(ZoomingMode.FIT_PAGE);\n    jqRoot.unbind(\"wheel.pdfjs\").bind(\"wheel.pdfjs\", (e) => {\n      if (this.isRendering) {\n        return;\n      }\n      let originalEvent = e.originalEvent as MouseEvent;\n      if (originalEvent.ctrlKey || originalEvent.metaKey) {\n        this.processEvent(e, this.zoomIn, this.zoomOut);\n      }\n      if (jqRoot.find(\".canvasWrapper\").hasClass(\"shadow\")) { // # that is, the whole page is shown, no scrollbars\n        this.processEvent(e, this.pageUp, this.pageDown);\n      }\n    });\n  }\n\n  private processEvent(e: JQueryMouseEventObject, negativeAction: () => void, positiveAction: () => void) {\n    const delta = normalize_mousewheel(e);\n    if (delta < -this.effectiveThreshold) {\n      negativeAction();\n      this.effectiveThreshold *= THRESHOLD_FACTOR;\n    } else if (delta > this.effectiveThreshold) {\n      positiveAction();\n      this.effectiveThreshold *= THRESHOLD_FACTOR;\n    } else {\n      this.effectiveThreshold /= THRESHOLD_FACTOR;\n    }\n    if (this.effectiveThreshold < THRESHOLD_INITIAL) {\n      this.effectiveThreshold = THRESHOLD_INITIAL;\n    }\n    this.utils.stopEvent(e);\n  }\n\n  private startRendering() {\n    this.isRendering = true;\n  }\n\n  private stopRendering(timeoutMs: number = CALMDOWN_TIMEOUT_MS) {\n    window.setTimeout(() => this.isRendering = false, timeoutMs);\n  }\n\n  isShown(): boolean {\n    return this.jqRoot.find(\"canvas\").length > 0;\n  }\n\n  // Schedules a new page open task. If queue is empty, the task is executed immediately, otherwise it is\n  // added to the queue and waits until the current task completes.\n  public show(url: string, page: number, isResize: boolean = false, mainFileId?: string) {\n    const isEmpty = this.queue.isEmpty();\n    this.queue.push(url, page, isResize, mainFileId);\n    if (isEmpty) {\n      this.completeTaskAndPullQueue(undefined);\n    }\n  }\n\n  // This method completes current task. It pulls the queue if queue is not empty, otherwise it\n  // shows error message if defined. Thus, should any step of task processing fail, we'll show error unless\n  // we have more tasks.\n  private completeTaskAndPullQueue(errorMessage?: string) {\n    if (this.currentTask) {\n      this.currentTask.complete();\n    }\n    this.currentTask = undefined;\n    if (this.queue.isEmpty()) {\n      if (errorMessage) {\n        this.alert.show(errorMessage);\n      }\n    } else {\n      let task = this.queue.pull();\n      if (task.isNewFile) {\n        this.currentFile = undefined;\n        this.zoom.onResize();\n      }\n      this.currentTask = task;\n      this.currentPage = task.page;\n      const onDocumentSuccess = (pdf) => {\n        this.currentFile = pdf;\n        this.currentFileUrl = task.url;\n        if (this.currentPage > pdf.numPages) {\n          this.currentPage = pdf.numPages;\n        }\n        this.openPage(pdf, this.currentPage);\n      };\n\n      const onDocumentFailure = (error: string) => {\n        this.logger.error(`Failed to fetch url=${task.url}, got error:${error}`);\n        this.stopRendering();\n        this.completeTaskAndPullQueue(this.i18n.text(\"js.pdfjs.failure.document\", error));\n      };\n      this.startRendering();\n      pdfjs.getDocument(task.url).then(onDocumentSuccess, onDocumentFailure);\n    }\n  }\n\n  private openPage(pdfFile: any, pageNumber: number) {\n    const onPageSuccess = (page: any) => {\n      if (this.currentTask) {\n        if (this.currentTask.isResize) {\n          this.resetPage()\n        }\n      }\n      let scale = this.zoom.factor(page, this.jqRoot);\n      if (!this.pdfPageView) {\n        this.pdfPageView = new PDFPageView.PDFPageView({\n          container: this.jqRoot.get(0),\n          id: pageNumber,\n          scale: scale,\n          defaultViewport: page.getViewport(1),\n          textLayerFactory: this.textLayerFactory\n        })\n      }\n      this.pdfPageView.update(scale);\n      this.pdfPageView.setPdfPage(page);\n      const onDrawSuccess = () => {\n        this.positionCanvas();\n        this.pageReady.invoke();\n        this.stopRendering();\n        this.completeTaskAndPullQueue(undefined)\n      };\n      const onDrawFailure = (error: string) => {\n        this.stopRendering();\n        this.logger.error(`Failed to render page ${pageNumber} from url=${pdfFile.url}, got error:${error}`);\n        this.completeTaskAndPullQueue(this.i18n.text(\"js.pdfjs.failure.page_render\", pageNumber, error))\n      };\n      this.pdfPageView.draw().then(onDrawSuccess, onDrawFailure)\n    };\n    const onPageFailure = (error: string) => {\n      this.stopRendering();\n      this.logger.error(`Failed to fetch page ${pageNumber} from url=${pdfFile.url}, got error:${error}`);\n      this.completeTaskAndPullQueue(this.i18n.text(\"js.pdfjs.failure.page_get\", pageNumber, error))\n    };\n    pdfFile.getPage(pageNumber).then(onPageSuccess, onPageFailure);\n    return true\n  }\n\n  private positionCanvas() {\n    const canvas = $(\".canvasWrapper\", this.jqRoot);\n    canvas.removeClass(\"hide\");\n    if (canvas.width() < this.jqRoot.width()) {\n      canvas.css(\"left\", `${(this.jqRoot.width()) / 2 - (canvas.width() / 2)}px`);\n    } else {\n      canvas.css(\"left\", \"0px\");\n    }\n    if (canvas.height() < this.jqRoot.height()) {\n      canvas.css(\"top\", `${(this.jqRoot.height()) / 2 - (canvas.height() / 2)}px`);\n    } else {\n      canvas.css(\"top\", \"0px\");\n    }\n    if (canvas.width() < this.jqRoot.width() && canvas.height() < this.jqRoot.height()) {\n      canvas.addClass(\"shadow\");\n    }\n    else {\n      canvas.removeClass(\"shadow\");\n    }\n    const canvasOffset = canvas.position();\n    const textLayer = $(\".textLayer\", this.jqRoot);\n    textLayer.css({\n      top : canvasOffset.top,\n      left : canvasOffset.left\n    });\n  }\n\n  resetCanvas() {\n    if (this.pdfPageView) {\n      this.pdfPageView.destroy();\n    }\n    this.pdfPageView = undefined;\n    this.jqRoot.empty();\n    this.queue.clear();\n  }\n\n  private openCurrentPage() {\n    if (this.currentFileUrl) {\n      let lastCompletedMainFileId = (this.queue.isEmpty() && this.queue.lastCompleted)\n          ? this.queue.lastCompleted.mainFileId : undefined;\n      this.show(this.currentFileUrl, this.currentPage, true, lastCompletedMainFileId);\n    }\n  }\n  private resetPage() {\n    if (this.currentPage !== undefined) {\n      this.zoom.onResize();\n    }\n  }\n\n  addOnPageReady(callback: any) {\n    this.pageReady.add(callback);\n  }\n\n  getRootElement(): JQuery { return this.jqRoot; }\n\n  onResize() {\n    if (this.currentFile) {\n      this.openCurrentPage();\n    }\n  }\n\n  pageUp = () => {\n    if (this.currentPage > 1) {\n      this.currentPage -= 1;\n      this.openCurrentPage();\n    }\n  };\n\n  pageDown = () => {\n    if (this.currentFile && this.currentPage < this.currentFile.numPages) {\n      this.currentPage += 1;\n      this.openCurrentPage();\n    }\n  };\n\n  getCurrentPage(): number | undefined { return this.currentPage; }\n\n  getZoomScale(): number { return this.zoom.current(); }\n\n  // Toolbar button handlers\n  zoomIn = () => {\n    this.zoom.zoomIn() && this.openCurrentPage();\n  };\n\n  zoomOut = () => {\n    this.zoom.zoomOut() && this.openCurrentPage();\n  };\n\n  zoomWidth = () => {\n    this.zoom.setFitting(ZoomingMode.FIT_WIDTH);\n    this.openCurrentPage();\n  };\n\n  zoomPage = () => {\n    this.zoom.setFitting(ZoomingMode.FIT_PAGE);\n    this.openCurrentPage();\n  };\n\n  zoomPreset(scale: number) {\n    this.zoom.setPreset(scale);\n    this.openCurrentPage();\n  }\n}\n"]}